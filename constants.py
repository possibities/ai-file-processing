#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
档案智能分类系统 - 常量定义模块
"""

# ── 实体分类编码 ──────────────────────────────────────────────────────────────
# 2020年（含）以后使用新编码
CODE_NEW = {
    "党群类": "DQL",
    "综合类": "ZHL",
    "业务类": "YWL",
}

# 2020年以前使用旧编码
CODE_OLD = {
    "党群类": "001",
    "综合类": "002",
    "业务类": "003",
}

# 编码切换节点
CODE_SWITCH_YEAR = 2020

# ── 保管期限优先级 ─────────────────────────────────────────────────────────────
# 数值越大优先级越高，用于规则7兜底判断
PERIOD_ORDER = {"10年": 1, "30年": 2, "永久": 3}

# ── 元数据字段定义 ─────────────────────────────────────────────────────────────
METADATA_SCHEMA = {
    "门类": "档案门类代码(WS-文书/ZP-照片/LY-录音/LX-录像/SW-实物/AC-会计/ZY-专业/XZ-行政/KJ-基建/KS-设备/Dg-电子)",
    "全宗号": "全宗编号(留空)",
    "归档年度": "文件归档年份(YYYY)",
    "实体分类号": "实体分类编号(2020年起: DQL/ZHL/YWL, 2020年以前: 001/002/003)",
    "实体分类名称": "实体分类名称(党群类/综合类/业务类)",
    "保管期限": "根据分类方案判断(永久/30年/10年)",
    "档号": "完整的档案编号",
    "件号": "按实体分类名称顺序递增的4位数字",
    "责任者": "发文单位或责任人",
    "文件编号": "原始文号(如: X林发[2006]XX号)",
    "题名": "文件标题(需包含时间、责任者、事由、文种)",
    "文件形成时间": "8位数字格式(YYYYMMDD)",
    "密级": "文件版头处的密级标注(只能填：非涉密/内部/秘密/机密/绝密，无标注填null，禁止推断)",
    "保密期限": "保密年限(1年/5年/10年,以文件内明确标注为主)",
    "备注": "备注信息",
    "开放状态": "是否开放(开放/控制)",
    "延期开放理由": "不开放的原因(工作秘密/商业秘密/个人隐私/负面信息)",
    "立档单位名称": "单位名称(如: 大冶市林业局)",
    "档案馆代码": "代码(留空)",
    "档案馆名称": "归属档案馆名称(留空)",
    "外包单位名称": "整理服务单位",
    "数字化时间": "从原始图片文件属性中提取的创建时间(格式：2025年2月)",
}

# ── 强制留空字段 ───────────────────────────────────────────────────────────────
FORCE_NULL_FIELDS = ["全宗号", "档案馆代码", "档案馆名称", "外包单位名称"]

# ── 开放状态控制关键词 ─────────────────────────────────────────────────────────
# 个人隐私
PRIVACY_KEYWORDS = [
    "工资表", "薪酬", "身份证号", "家庭住址",
    "联系电话", "个人档案", "病历", "体检",
]

# 商业秘密
COMMERCIAL_KEYWORDS = [
    "商业机密", "报价单", "成本核算", "利润",
    "客户名单", "技术配方", "核心代码", "底标",
]

# 商业秘密豁免（公开招投标结果）
COMMERCIAL_EXEMPT_KEYWORDS = [
    "中标结果", "中标公示", "中标通知书", "中标公告"
]

# 负面信息（题名关键词）
NEGATIVE_TITLE_KEYWORDS = [
    "批评通报", "通报批评", "批评意见", "诫勉谈话", "诫勉约谈"
]

# 负面信息（正则模式）
NEGATIVE_PATTERNS = [
    r"给予.*处分", r"党纪.*处分", r"行政.*处分",
    r"撤职", r"开除", r"留党察看", r"降级",
    r"记大过", r"撤销职务", r"严重警告",
    r"问责", r"追责", r"责令.*检查",
]

# 工作秘密关键词（密级字段标注，非正文推断）
# 注意：此常量仅用于密级字段值的判定，不用于正文内容扫描
WORK_SECRET_KEYWORDS = ["内部", "秘密", "机密", "绝密"]

# 受控密级值（与WORK_SECRET_KEYWORDS保持一致）
CONTROLLED_SECURITY_LEVELS = ["内部", "秘密", "机密", "绝密"]

# ── OCR文本清洗替换表 ──────────────────────────────────────────────────────────
OCR_REPLACEMENTS = {
    'Ｏ': '0', 'ｏ': '0',
    'Ｉ': '1', 'ｌ': '1',
    '（': '(', '）': ')',
    '【': '[', '】': ']',
    '：': ':', '；': ';',
    '，': ',', '。': '.',
    '\x0c': '',
    '\xa0': ' ',
}

# OCR置信度阈值
OCR_CONFIDENCE_SHORT = 0.7   # 短文本（≤3字）
OCR_CONFIDENCE_NORMAL = 0.6  # 普通文本
OCR_SHORT_TEXT_LEN = 3

# ── 补充规则关键词 ─────────────────────────────────────────────────────────────
# 规则1: 培训类
TRAINING_KEYWORDS = ["培训", "学习班", "培训会", "培训班", "轮训", "讲座"]
# 规则1排除词：避免将"培训制度"或"党务培训"误判
TRAINING_MGMT_KEYWORDS = ["经费", "制度", "管理", "办法", "规定", "考勤"]

PARTY_TRAINING_KEYWORDS = [
    "党员", "党务", "党建", "党校", "支部", "书记", "入党", "积极分子"
]

# 规则3: 档案寄存/地址变更
ADDRESS_CHANGE_KEYWORDS = ["档案寄存", "地址变更", "寄存地址"]

# 规则4: 安装/维修类
MAINTENANCE_KEYWORDS = ["安装", "维修", "修理", "检修", "维护"]
MAINTENANCE_DOC_TYPES = ["函", "通知"]

# 规则5: 重要通知判定
IMPORTANT_NOTICE_KEYWORDS = [
    "重要", "紧急", "特急", "党委", "党组", "纪委",
    "表彰", "任命", "决定", "决议", "规划", "总结"
]

# 规则6: 内部制度类
REGULATION_KEYWORDS = ["制度", "管理办法", "条例", "实施细则", "章程"]
INTERNAL_ORG_KEYWORDS = ["公司", "本单位", "我司", "集团", "内部"]

# 规则9: 中标类
BID_KEYWORDS = ["结果", "公示", "通知"]

# ── 简报分类关键词（规则2扩展：简报内容决定分类）────────────────────────────────
# 简报→党群类：内容涉及党务工作
BRIEFING_PARTY_KEYWORDS = [
    # 党风廉政专项（明确党务事项，使用组合词防止宽泛匹配）
    "党风廉政", "廉洁自律", "廉政教育", "廉政建设", "警示教育",
    "党纪教育", "廉政警示",
    # 党支部/党组织专项活动（不使用单字"书记"，改用组合词）
    "党支部活动", "党支部会议", "党支部书记",
    "民主生活会", "组织生活会", "主题党日",
    # 党建/党务工作（组合词）
    "党建工作", "党务工作", "党的建设",
    # 纪委/纪检/巡察（专属党务机构）
    "纪委", "纪检", "巡察", "巡视",
    # 发展党员专项
    "发展党员", "入党积极分子", "入党宣誓",
    # 工青妇组织专项活动（组合词）
    "工青妇", "工会活动", "团委活动", "妇联活动",
]
# 简报→业务类：内容涉及档案业务或公司内部培训
BRIEFING_BUSINESS_KEYWORDS = [
    "档案整理", "档案管理", "档案规范", "档案工作",
    "培训", "学习班", "培训会", "培训班", "轮训",
]
# 简报→综合类：兜底（不含党务、不含档案/培训业务）

# 业务类误判兜底：这些文种/特征出现时，即使LLM判定为业务类也应强制纠正为综合类
# 依据：业务类仅限"档案工作文件"和"公司内部培训"，其余一律综合类
BUSINESS_FALSE_POSITIVE_DOC_TYPES = [
    "通知", "函", "复函", "通函", "请示", "批复", "报告",
    "方案", "计划", "总结", "纪要", "决定", "意见", "公告",
    "通报", "中标通知", "询价", "招标",
]
# 业务类误判兜底排除词：题名含以下词时确实属于业务类，不触发纠正
BUSINESS_LEGITIMATE_KEYWORDS = [
    "档案整理", "档案规范", "档案移交", "档案鉴定", "档案统计",
    "档案查阅", "档案借阅", "档案销毁", "全宗", "著录",
    "培训通知", "培训计划", "培训总结", "培训方案", "培训材料",
]

# 规则10: 党支部调整类
PARTY_BRANCH_ADJUST_KEYWORDS = ["更换", "调整", "改选", "补选", "换届"]
PARTY_BRANCH_TARGET_KEYWORDS = ["组织", "委员", "书记"]

# 规则10排除词：换届选举结果→永久，不得被规则10降为30年
PARTY_BRANCH_ELECTION_RESULT_KEYWORDS = ["选举结果", "换届选举结果", "当选公告"]

# ── 示例JSON输出（用于提示词） ─────────────────────────────────────────────────
EXAMPLE_OUTPUT_1 = """{
  "门类": "WS-文书",
  "全宗号": null,
  "归档年度": "2020",
  "实体分类号": "YWL",
  "实体分类名称": "业务类",
  "保管期限": "10年",
  "档号": "2020-YWL-10-0001",
  "件号": "0001",
  "责任者": "黄石市脉源通档案管理有限公司",
  "文件编号": null,
  "题名": "人事档案专业整理技术培训简报第2期",
  "文件形成时间": "20200713",
  "页数": 4,
  "密级": null,
  "保密期限": null,
  "备注": null,
  "开放状态": "开放",
  "延期开放理由": null,
  "立档单位名称": "黄石市脉源通档案管理有限公司",
  "档案馆代码": null,
  "档案馆名称": null,
  "外包单位名称": "湖北脉源通档案管理有限公司",
  "数字化时间": "2026年2月"
}"""

EXAMPLE_OUTPUT_2 = """{
  "门类": "WS-文书",
  "全宗号": null,
  "归档年度": "2020",
  "实体分类号": "ZHL",
  "实体分类名称": "综合类",
  "保管期限": "30年",
  "档号": "2020-ZHL-30-0012",
  "件号": "0012",
  "责任者": "XX单位",
  "文件编号": "XX[2020]15号",
  "题名": "关于对XX同志批评教育的通报",
  "文件形成时间": "20200615",
  "页数": 3,
  "密级": null,
  "保密期限": null,
  "备注": null,
  "开放状态": "控制",
  "延期开放理由": "负面信息",
  "立档单位名称": "XX单位",
  "档案馆代码": null,
  "档案馆名称": null,
  "外包单位名称": "湖北脉源通档案管理有限公司",
  "数字化时间": "2026年2月"
}"""

EXAMPLE_OUTPUT_3 = """{
  "门类": "WS-文书",
  "全宗号": null,
  "归档年度": "2020",
  "实体分类号": "ZHL",
  "实体分类名称": "综合类",
  "保管期限": "永久",
  "档号": "2020-ZHL-Y-0015",
  "件号": "0015",
  "责任者": "XX单位",
  "文件编号": null,
  "题名": "2020年度职工工资表",
  "文件形成时间": "20201231",
  "页数": 8,
  "密级": null,
  "保密期限": null,
  "备注": null,
  "开放状态": "控制",
  "延期开放理由": "个人隐私",
  "立档单位名称": "XX单位",
  "档案馆代码": null,
  "档案馆名称": null,
  "外包单位名称": "湖北脉源通档案管理有限公司",
  "数字化时间": "2026年2月"
}"""